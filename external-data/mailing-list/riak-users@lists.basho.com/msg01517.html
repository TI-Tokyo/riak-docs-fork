<!DOCTYPE html>
<html lang="en">
<head>
<title>Ripple associations problem</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="contents" href="index.html#01517" id="c">
<link rel="index" href="maillist.html#01517" id="i">
<link rel="prev" href="msg01510.html" id="p">
<link rel="next" href="msg01519.html" id="n">
<link rel="canonical" href="https://www.mail-archive.com/riak-users@lists.basho.com/msg01517.html">
<link rel="stylesheet" href="/normalize.css" media="screen">
<link rel="stylesheet" href="/master.css" media="screen">

<!--[if lt IE 9]>
<link rel="stylesheet" href="/ie.css" media="screen">
<![endif]-->
</head>
<body>
<script language="javascript" type="text/javascript">
document.onkeydown = NavigateThrough;
function NavigateThrough (event)
{
  if (!document.getElementById) return;
  if (window.event) event = window.event;
  if (event.target.tagName == 'INPUT') return;
  if (event.ctrlKey || event.metaKey) return;
  var link = null;
  switch (event.keyCode ? event.keyCode : event.which ? event.which : null) {
    case 74:
    case 80:
      link = document.getElementById ('p');
      break;
    case 75:
    case 78:
      link = document.getElementById ('n');
      break;
    case 69:
      link = document.getElementById ('e');
      break;
    }
  if (link && link.href) document.location = link.href;
}
</script>
<div itemscope itemtype="http://schema.org/Article" class="container">
<div class="skipLink">
<a href="#nav">Skip to site navigation (Press enter)</a>
</div>
<div class="content" role="main">
<div class="msgHead">
<h1>
<span class="subject"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Ripple+associations+problem%22&amp;o=newest" rel="nofollow"><span itemprop="name">Ripple associations problem</span></a></span>
</h1>
<p class="darkgray font13">
<span class="sender pipe"><a href="/search?l=riak-users@lists.basho.com&amp;q=from:%22Antonio+Fern%C3%A1ndez+Vara%22" rel="nofollow"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Antonio Fernández Vara</span></span></a></span>
<span class="date"><a href="/search?l=riak-users@lists.basho.com&amp;q=date:20101110" rel="nofollow">Wed, 10 Nov 2010 10:52:43 -0800</a></span>
</p>
</div>
<div itemprop="articleBody" class="msgBody">
<!--X-Body-of-Message-->
<pre>Hi all,

I hope you can help me with this problem. I'm new to ripple/riak and Im
trying a bit of code on rails. I'm trying a little application with Devise
just to see how it works.</pre><pre>

Just trying a few things I found this problem:


-----
class User
  include Ripple::Document

  devise :database_authenticatable, :confirmable,
         :rememberable, :registerable, :trackable, :timeoutable,
:validatable,
         :token_authenticatable

  property :email,                 String, :presence =&gt; true
  property :password,              String
  property :password_confirmation, String

  timestamps!

  key_on :email

  one :profile

  def id
    email
  end

end


class Profile
  include Ripple::Document

  property :first_name,        String
  property :last_name,         String

  property :username,          String,    :presence =&gt; true

  timestamps!

  key_on :username

  one :user

  def id
    username
  end

end



----
*In the console.*

 &gt;&gt;     u = User.create(:email =&gt; 'antoniofernandezv...@gmail.com',
:password =&gt; '123456', :password_confirmation =&gt; '123456')
=&gt; 
&lt;User:antoniofernandezv...@gmail.com&lt;user%3aantoniofernandezv...@gmail.com&gt;encrypted_password=&quot;$2a$10$cQVKORpRIf3TGi2Z8SBXFOy6bEsnLAdbtNRTLLn4t0yKq1X37jsd2&quot;
created_at=Wed Nov 10 18:40:43 UTC 2010 updated_at=Wed Nov 10 18:40:43 UTC
2010 confirmation_sent_at=Wed Nov 10 18:40:43 UTC 2010
password_confirmation=nil last_sign_in_ip=nil last_sign_in_at=nil
sign_in_count=nil password_salt=&quot;$2a$10$cQVKORpRIf3TGi2Z8SBXFO&quot;
current_sign_in_ip=nil authentication_token=nil remember_token=nil
current_sign_in_at=nil confirmation_token=&quot;GsVcI_YJKir5lB8nljG5&quot;
remember_created_at=nil password=nil email=&quot;antoniofernandezv...@gmail.com&quot;
confirmed_at=nil&gt;
&gt;&gt;     p = Profile.create(:username =&gt; 'fernandezvara', :first_name =&gt;
'Antonio', :last_name =&gt; 'Fernndez Vara')
=&gt; &lt;Profile:fernandezvara created_at=Wed Nov 10 18:41:02 UTC 2010
updated_at=Wed Nov 10 18:41:02 UTC 2010 username=&quot;fernandezvara&quot;
last_name=&quot;Fernndez Vara&quot; first_name=&quot;Antonio&quot;&gt;
&gt;&gt; u.profile = p
=&gt; &lt;Profile:fernandezvara created_at=Wed Nov 10 18:41:02 UTC 2010
updated_at=Wed Nov 10 18:41:02 UTC 2010 username=&quot;fernandezvara&quot;
last_name=&quot;Fernndez Vara&quot; first_name=&quot;Antonio&quot;&gt;
&gt;&gt; u.save
=&gt; true
&gt;&gt; p.user = u
=&gt; 
&lt;User:antoniofernandezv...@gmail.com&lt;user%3aantoniofernandezv...@gmail.com&gt;encrypted_password=&quot;$2a$10$cQVKORpRIf3TGi2Z8SBXFOy6bEsnLAdbtNRTLLn4t0yKq1X37jsd2&quot;
created_at=Wed Nov 10 18:40:43 UTC 2010 updated_at=Wed Nov 10 18:41:14 UTC
2010 confirmation_sent_at=Wed Nov 10 18:40:43 UTC 2010
password_confirmation=nil last_sign_in_ip=nil last_sign_in_at=nil
sign_in_count=nil password_salt=&quot;$2a$10$cQVKORpRIf3TGi2Z8SBXFO&quot;
current_sign_in_ip=nil authentication_token=nil remember_token=nil
current_sign_in_at=nil confirmation_token=&quot;GsVcI_YJKir5lB8nljG5&quot;
remember_created_at=nil password=nil email=&quot;antoniofernandezv...@gmail.com&quot;
confirmed_at=nil&gt;
&gt;&gt; p.save
=&gt; true


*--- Creation and associations work correctly. (at least it appears)*
*
*
*---------- First, query for the profile of the user (Works!)*

?&gt; uu = User.find('antoniofernandezv...@gmail.com')
=&gt; 
&lt;User:antoniofernandezv...@gmail.com&lt;user%3aantoniofernandezv...@gmail.com&gt;encrypted_password=&quot;$2a$10$cQVKORpRIf3TGi2Z8SBXFOy6bEsnLAdbtNRTLLn4t0yKq1X37jsd2&quot;
created_at=Wed Nov 10 18:40:43 UTC 2010 updated_at=Wed Nov 10 18:41:14 UTC
2010 confirmation_sent_at=&quot;Wed, 10 Nov 2010 18:40:43 -0000&quot;
password_confirmation=nil last_sign_in_ip=nil last_sign_in_at=nil
sign_in_count=nil password_salt=&quot;$2a$10$cQVKORpRIf3TGi2Z8SBXFO&quot;
current_sign_in_ip=nil authentication_token=nil remember_token=nil
current_sign_in_at=nil confirmation_token=&quot;GsVcI_YJKir5lB8nljG5&quot;
remember_created_at=nil password=nil email=&quot;antoniofernandezv...@gmail.com&quot;
confirmed_at=nil&gt;
&gt;&gt; uu.profile
=&gt; &lt;Profile:fernandezvara created_at=Wed Nov 10 18:41:02 UTC 2010
updated_at=Wed Nov 10 18:41:26 UTC 2010 username=&quot;fernandezvara&quot;
last_name=&quot;Fernndez Vara&quot; first_name=&quot;Antonio&quot;&gt;


*----------- Second, query for the user referenced by the profile (Error!)*

?&gt; pp = Profile.find('fernandezvara')
=&gt; &lt;Profile:fernandezvara created_at=Wed Nov 10 18:41:02 UTC 2010
updated_at=Wed Nov 10 18:41:26 UTC 2010 username=&quot;fernandezvara&quot;
last_name=&quot;Fernndez Vara&quot; first_name=&quot;Antonio&quot;&gt;
&gt;&gt; pp.user
NoMethodError: undefined method `key' for nil:NilClass
from
/Library/Ruby/Gems/1.8/gems/activesupport-3.0.1/lib/active_support/whiny_nil.rb:48:in
`method_missing'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/document/finders.rb:121:in
`instantiate'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/one_linked_proxy.rb:25:in
`send'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/one_linked_proxy.rb:25:in
`find_target'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/proxy.rb:113:in
`load_target'
from
/Library/Ruby/Gems/1.8/gems/ripple-0.8.2/lib/ripple/associations/proxy.rb:41:in
`inspect'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:302:in
`output_value'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:151:in
`eval_input'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:263:in
`signal_status'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:147:in
`eval_input'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:146:in
`eval_input'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:70:in
`start'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:69:in
`catch'
from
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/irb.rb:69:in
`start'
from
/Library/Ruby/Gems/1.8/gems/railties-3.0.1/lib/rails/commands/console.rb:44:in
`start'
from
/Library/Ruby/Gems/1.8/gems/railties-3.0.1/lib/rails/commands/console.rb:8:in
`start'
from /Library/Ruby/Gems/1.8/gems/railties-3.0.1/lib/rails/commands.rb:23
from script/rails:6:in `require'
from script/rails:6&gt;&gt;


Can someone point me what i'm doing wrong? I'm so lost.

Thanks in advance.
</pre><pre>_______________________________________________
riak-users mailing list
riak-users@lists.basho.com
<a  rel="nofollow" href="http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com">http://lists.basho.com/mailman/listinfo/riak-users_lists.basho.com</a>
</pre>

</div>
<div class="msgButtons margintopdouble">
<ul class="overflow">
<li class="msgButtonItems"><a class="button buttonleft " accesskey="p" href="msg01510.html">Previous message</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="c" href="index.html#01517">View by thread</a></li>
<li class="msgButtonItems textaligncenter"><a class="button" accesskey="i" href="maillist.html#01517">View by date</a></li>
<li class="msgButtonItems textalignright"><a class="button buttonright " accesskey="n" href="msg01519.html">Next message</a></li>
</ul>
</div>
<a name="tslice"></a>
<div class="tSliceList margintopdouble">
<ul class="icons monospace">

</ul>
</div>
<div class="overflow msgActions margintopdouble">
<div class="msgReply" >
<h2>
					Reply via email to
</h2>
<form method="POST" action="/mailto.php">
<input type="hidden" name="subject" value="Ripple associations problem">
<input type="hidden" name="msgid" value="AANLkTimq66KjnitfS+tyMUvX_h3Ny==vazc4gbiW-UKH@mail.gmail.com">
<input type="hidden" name="relpath" value="riak-users@lists.basho.com/msg01517.html">
<input type="submit" value=" Antonio Fernández Vara ">
</form>
</div>
</div>
</div>
<div class="aside" role="complementary">
<div class="logo">
<a href="/"><img src="/logo.png" width=247 height=88 alt="The Mail Archive"></a>
</div>
<form class="overflow" action="/search" method="get">
<input type="hidden" name="l" value="riak-users@lists.basho.com">
<label class="hidden" for="q">Search the site</label>
<input class="submittext" type="text" id="q" name="q" placeholder="Search riak-users">
<input class="submitbutton" name="submit" type="image" src="/submit.png" alt="Submit">
</form>
<div class="nav margintop" id="nav" role="navigation">
<ul class="icons font16">
<li class="icons-home"><a href="/">The Mail Archive home</a></li>
<li class="icons-list"><a href="/riak-users@lists.basho.com/">riak-users - all messages</a></li>
<li class="icons-about"><a href="/riak-users@lists.basho.com/info.html">riak-users - about the list</a></li>
<li class="icons-expand"><a href="/search?l=riak-users@lists.basho.com&amp;q=subject:%22Ripple+associations+problem%22&amp;o=newest&amp;f=1" title="e" id="e">Expand</a></li>
<li class="icons-prev"><a href="msg01510.html" title="p">Previous message</a></li>
<li class="icons-next"><a href="msg01519.html" title="n">Next message</a></li>
</ul>
</div>
<div class="listlogo margintopdouble">

</div>
<div class="margintopdouble">

</div>
</div>
</div>
<div class="footer" role="contentinfo">
<ul>
<li><a href="/">The Mail Archive home</a></li>
<li><a href="/faq.html#newlist">Add your mailing list</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/faq.html#support">Support</a></li>
<li><a href="/faq.html#privacy">Privacy</a></li>
<li class="darkgray">AANLkTimq66KjnitfS+tyMUvX_h3Ny==vazc4gbiW-UKH@mail.gmail.com</li>
</ul>
</div>
</body>
</html>
